"use strict";(()=>{var e={};e.id=405,e.ids=[405],e.modules={6951:(e,t,s)=>{s.r(t),s.d(t,{config:()=>k,default:()=>w,getServerSideProps:()=>y,getStaticPaths:()=>N,getStaticProps:()=>b,reportWebVitals:()=>P,routeModule:()=>T,unstable_getServerProps:()=>E,unstable_getServerSideProps:()=>H,unstable_getStaticParams:()=>D,unstable_getStaticPaths:()=>q,unstable_getStaticProps:()=>C});var r={};s.r(r),s.d(r,{default:()=>Home});var a=s(7093),l=s(5244),n=s(1323),i=s(4003),c=s(9597),u=s(997),d=s(597),o=s(6689),x=s(1649),h=s(8193),f=s(1664),p=s.n(f),m=s(5675),g=s.n(m);function HomeHeader(){let{data:e}=(0,x.useSession)(),[t,s]=(0,o.useState)(!1),[r,a]=(0,o.useState)(!1);return(0,u.jsxs)("div",{className:" h-[10vh] flex items-center justify-between",children:[u.jsx("h2",{children:(0,u.jsxs)("div",{className:" hidden lg:flex gap-2 items-center",children:[u.jsx(g(),{width:50,height:50,src:e?.user?.image,alt:"",className:"w-6 h-6 rounded-md sm:hidden"}),(0,u.jsxs)("div",{children:[(0,u.jsxs)("h4",{className:"black_text  leading-5 lg:leading-10",children:["Hello, ",u.jsx("b",{children:e?.user?.name})]}),u.jsx("h5",{className:"grey_text leading-3",children:"Current state of your shop"})]})]})}),(0,u.jsxs)("div",{className:"px-3 py-1 relative",children:[(0,u.jsxs)("div",{className:"flex gap-1 text-black items-center",children:[u.jsx(g(),{width:50,height:50,src:e?.user?.image,alt:"",className:"w-[40px] h-[40px] rounded-xl"}),u.jsx("span",{className:"px-2",children:u.jsx("p",{className:"grey_text",children:e?.user?.name})}),u.jsx("button",{onClick:()=>s(!t),children:u.jsx(h.w4J,{size:20})})]}),(0,u.jsxs)("div",{className:`grey_text absolute right-[0rem] top-full p-2 ${t?"block":"hidden"}`,children:[u.jsx(p(),{href:"/account",children:u.jsx("p",{children:"Account"})}),u.jsx(p(),{href:"/support",children:u.jsx("p",{children:"Support"})}),u.jsx(p(),{onClick:()=>(0,x.signOut)("google"),href:"/",children:u.jsx("p",{children:"Logout"})})]})]})]})}var j=s(2167),v=s.n(j);let boxes_StatsBox=function(e){let t=e.percent_value>0,s=e.value_week>0;return u.jsx("div",{className:`w-[22rem] h-[10rem] shadow-xl rounded-xl ${e.background}`,children:(0,u.jsxs)("div",{className:"ml-5  flex flex-col justify-evenly h-full",children:[u.jsx("h5",{className:` uppercase font-light ${e.text} `,children:e.title}),u.jsx("h4",{className:` uppercase font-bold  ${e.text}`,children:e.value}),(0,u.jsxs)("div",{className:"flex flex-row w-full items-center justify-between",children:[(0,u.jsxs)("p",{className:`white_text uppercase  ${s?"green_text":"red_text"}`,children:[e.percent_value,"% această lună"]}),(0,u.jsxs)("p",{className:`white_text uppercase mr-5  ${t?"green_text":"red_text"}`,children:[e.value_week,"% această săptam\xe2nă"]})]})]})})},_=require("date-fns/subHours");var S=s.n(_);function TopSalesStats(){let[e,t]=(0,o.useState)([]),[s,r]=(0,o.useState)([]),[a,l]=(0,o.useState)([]);(0,o.useEffect)(()=>{v().get("/api/orders").then(e=>{t(e.data)}),v().get("/api/products").then(e=>{r(e.data)})},[]);let calculateProductCounts=()=>{let t={};e.forEach(e=>{e.line_items.forEach(e=>{let s=e.productId;s&&(t[s]?t[s]++:t[s]=1)})});let s=Object.entries(t).map(([e,t])=>({productId:e,count:t}));return s.sort((e,t)=>t.count-e.count),l(s.slice(0,3)),s};return(0,o.useEffect)(()=>{calculateProductCounts()},[e,s]),(0,u.jsxs)("div",{className:"h-[30vh] w-full lg:w-[25rem] flex flex-col items-center lg:justify-start lg:text-left text-center justify-center ",children:[u.jsx("h4",{className:" black_text  font-medium uppercase",children:"Top 3 cele mai v\xe2ndute produse"}),u.jsx("div",{className:"text-center lg:text-left flex items-center lg:items-start justify-center gap-5",children:a.map(({productId:e,count:t})=>{let r=s.find(t=>t._id===e);return(0,u.jsxs)("div",{children:[(0,u.jsxs)("h5",{className:"grey_text",children:["Nume: ",r?r.title:"Unknown"]}),(0,u.jsxs)("h5",{className:"grey_text",children:["Cantitate: ",t]})]},e)})})]})}function CityStats(){let[e,t]=(0,o.useState)([]),[s,r]=(0,o.useState)([]);(0,o.useEffect)(()=>{v().get("/api/orders").then(e=>{t(e.data)})},[]);let calculateCityCounts=()=>{let t={};e.forEach(e=>{let s=e.city;s&&(t[s]?t[s]++:t[s]=1)});let s=Object.entries(t).map(([e,t])=>({city:e,count:t}));return s.sort((e,t)=>t.count-e.count),r(s.slice(0,3)),s};return(0,o.useEffect)(()=>{calculateCityCounts()},[e]),(0,u.jsxs)("div",{className:"h-[30vh]  w-full lg:w-[25rem] flex flex-col items-center lg:justify-start lg:text-left text-center justify-center",children:[u.jsx("h4",{className:" black_text font-medium uppercase text-left",children:"Top 3 orașe după numărul de comenzi"}),u.jsx("div",{className:"text-center lg:text-left flex items-center lg:items-start justify-center gap-5",children:s.map(({city:e,count:t})=>(0,u.jsxs)("div",{children:[(0,u.jsxs)("h5",{className:"grey_text",children:["Oraș: ",e]}),(0,u.jsxs)("h5",{className:"grey_text ",children:["Număr comenzi: ",t]})]},e))})]})}let HomeStats=function(){let e,t;let[s,r]=(0,o.useState)([]),[a,l]=(0,o.useState)([]),{data:n}=(0,x.useSession)();function revenueTotal(e){let t=0;for(let s in e.line_items){let r=e.line_items[s],l=r.productId,n=r.quantity,i=function(e){let t=a.find(t=>t._id===e);return t?t.price:0}(l);t+=n*i}return t}return(0,o.useEffect)(()=>{v().get("/api/orders").then(e=>{r(e.data)}),v().get("/api/products").then(e=>{l(e.data)})},[]),(0,u.jsxs)("div",{className:"flex flex-col gap-10 mt-10 min-h-screen",children:[(0,u.jsxs)("div",{className:"flex gap-10 lg:flex-row flex-col items-center justify-enevly overflow-x-hidden h-auto py-10",children:[u.jsx(boxes_StatsBox,{background:"#252525",text:"black_text",title:"V\xe2nzări totale",value:(e=0,s.forEach(t=>{e+=revenueTotal(t)}),e),percent_value:function(){let e=new Date,t=s.filter(t=>new Date(t.createdAt)>S()(e,720)),r=t.reduce((e,t)=>e+revenueTotal(t),0),a=s.filter(t=>new Date(t.createdAt)>S()(e,1440)).reduce((e,t)=>e+revenueTotal(t),0);return((r-a)/a*100).toFixed(2)}(),value_week:function(){let e=s.filter(e=>new Date(e.createdAt)>S()(new Date,168)),t=e.reduce((e,t)=>e+revenueTotal(t),0),r=s.filter(e=>new Date(e.createdAt)>S()(new Date,336)).reduce((e,t)=>e+revenueTotal(t),0);return((t-r)/r*100).toFixed(2)}()}),u.jsx(boxes_StatsBox,{background:"#fff",text:"black_text",title:"Comenzi totale",value:(t=0,s.forEach(e=>{t++}),t),percent_value:function(){let e=new Date;return s.filter(t=>new Date(t.createdAt)>S()(e,720))}().length,value_week:function(){let e=new Date;return s.filter(t=>new Date(t.createdAt)>S()(e,168))}().length})]}),(0,u.jsxs)("div",{className:"flex gap-10 lg:flex-row flex-col items-center justify-enevly overflow-x-hidden h-auto py-10",children:[u.jsx(TopSalesStats,{}),u.jsx(CityStats,{})]})]})};function Home(){return(0,u.jsxs)(d.Z,{children:[u.jsx(HomeHeader,{}),u.jsx(HomeStats,{})]})}let w=(0,n.l)(r,"default"),b=(0,n.l)(r,"getStaticProps"),N=(0,n.l)(r,"getStaticPaths"),y=(0,n.l)(r,"getServerSideProps"),k=(0,n.l)(r,"config"),P=(0,n.l)(r,"reportWebVitals"),C=(0,n.l)(r,"unstable_getStaticProps"),q=(0,n.l)(r,"unstable_getStaticPaths"),D=(0,n.l)(r,"unstable_getStaticParams"),E=(0,n.l)(r,"unstable_getServerProps"),H=(0,n.l)(r,"unstable_getServerSideProps"),T=new a.PagesRouteModule({definition:{kind:l.x.PAGES,page:"/index",pathname:"/",bundlePath:"",filename:""},components:{App:c.default,Document:i.default},userland:r})},2167:e=>{e.exports=require("axios")},1649:e=>{e.exports=require("next-auth/react")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[859,450,201,263,163,493,597],()=>__webpack_exec__(6951));module.exports=s})();